@{
    Layout = null;
}

@model User

<style>
    /* Global Styles */
    body {
        background-color: #f0f4f8;
        font-family: Arial, sans-serif;
    }

    h2 {
        color: #0056b3;
        text-align: center;
        font-size: 24px;
    }

    p {
        color: #333;
        font-size: 16px;
        text-align: center;
    }

    .form-container {
        max-width: 600px;
        margin: 0 auto;
        margin-top: 30px;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .form-container-table {
        max-width: 1000px;
        margin: 0 auto;
        margin-top: 30px;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .form-label {
        font-weight: bold;
    }

    .mb-3 {
        margin-bottom: 20px;
    }

    /* Button Styling */
    .btn-success {
        background-color: #28a745;
        border-color: #28a745;
    }

    .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
    }

    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    .btn {
        padding: 10px 20px;
        font-size: 16px;
    }

    /* Styling for Input Fields */
    .form-control {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border-radius: 5px;
        border: 1px solid #ccc;
        background-color: #fff;
        line-height: 1.5;
        box-sizing: border-box;
    }

    /* Styling for the Select Dropdown */
    .select-wrapper {
        width: 100%;
        display: block;
        position: relative;
    }

    select.form-control {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border-radius: 5px;
        border: 1px solid #ccc;
        background-color: #fff;
        line-height: 1.5;
    }

    /* Margin and spacing adjustments for the fields */
    .mb-3 {
        margin-bottom: 20px;
    }

        .mb-3 label {
            font-size: 16px;
            margin-bottom: 8px;
        }

    /* Button style for the form submission */
    button.btn-primary {
        background-color: #007bff;
        border-color: #007bff;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        margin-top: 20px;
        width: 100%;
        cursor: pointer;
    }

        button.btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

    table {
    border-collapse: collapse; /* Menggabungkan garis tepi untuk tampilan bersih */
    width: 100%; /* Agar tabel menyesuaikan lebar kontainer */
}

th, td {
    border: 1px solid #ccc; /* Garis tepi di setiap kolom dan baris */
    padding: 10px; /* Ruang dalam untuk setiap sel */
    text-align: left; /* Teks rata kiri */
}

th {
    background-color: #f8f9fa; /* Warna latar untuk header tabel */
    font-weight: bold; /* Membuat teks header tebal */
}

tr:nth-child(even) {
    background-color: #f2f2f2; /* Alternatif warna untuk setiap baris genap */
}

tr:hover {
    background-color: #e9ecef; /* Warna latar saat baris di-hover */
}
</style>

<h2>Welcome, @Model.Username!</h2>
<p>Your user ID is @Model.UserId</p>
<p>Your account is @(Model.IsActive ? "Active" : "Inactive")</p>
<div class="form-container-table">
    <h2>Data List</h2>
    <table class="table table-striped" id="dataTable">
        <thead>
            <tr>
                <th>Agreement Number</th>
                <th>BPKB No</th>
                <th>Branch ID</th>
                <th>BPKB Date</th>
                <th>Faktur No</th>
                <th>Faktur Date</th>
                <th>Location Name</th>
                <th>Police No</th>
                <th>BPKB Date In</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data akan diisi melalui JavaScript -->
        </tbody>
    </table>
</div>

<div class="form-container">
    <form id="addDataForm">
        <div class="mb-3">
            <label for="AgreementNumber" class="form-label">Agreement Number</label>
            <input type="text" class="form-control" id="AgreementNumber" name="AgreementNumber" required />
        </div>
        <div class="mb-3">
            <label for="BranchId" class="form-label">Branch Id</label>
            <input type="text" class="form-control" id="BranchId" name="BranchId" required />
        </div>
        <div class="mb-3">
            <label for="NoBPKB" class="form-label">No. BPKB</label>
            <input type="text" class="form-control" id="NoBPKB" name="NoBPKB" required />
        </div>
        <div class="mb-3">
            <label for="TanggalBPKBIn" class="form-label">Tanggal BPKB In</label>
            <input type="date" class="form-control" id="TanggalBPKBIn" name="TanggalBPKBIn" required />
        </div>
        <div class="mb-3">
            <label for="TanggalBPKB" class="form-label">Tanggal BPKB</label>
            <input type="date" class="form-control" id="TanggalBPKB" name="TanggalBPKB" required />
        </div>
        <div class="mb-3">
            <label for="NoFaktur" class="form-label">No. Faktur</label>
            <input type="text" class="form-control" id="NoFaktur" name="NoFaktur" required />
        </div>
        <div class="mb-3">
            <label for="TanggalFaktur" class="form-label">Tanggal Faktur</label>
            <input type="date" class="form-control" id="TanggalFaktur" name="TanggalFaktur" required />
        </div>
        <div class="mb-3">
            <label for="NoPolisi" class="form-label">No. Polisi</label>
            <input type="text" class="form-control" id="NoPolisi" name="NoPolisi" required />
        </div>
        <div class="mb-3">
            <label for="LokasiPenyimpanan" class="form-label">Lokasi Penyimpanan</label>
            <select class="form-control" id="LokasiPenyimpanan" name="LokasiPenyimpanan" required>
                <option value="1">Location 1</option>
                <option value="2">Location 2</option>
                <option value="3">Location 3</option>
            </select>
        </div>
        <div class="mb-3">
            <button type="submit" class="btn btn-primary">Save</button>
        </div>
    </form>
    <div id="responseMessage"></div>
</div>

<script>
    document.getElementById('addDataForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const formData = new FormData(event.target);
        console.log(formData);
        const data = {
            AgreementNumber: formData.get('AgreementNumber'),
            BpkbNo: formData.get('NoBPKB'),
            BranchId: formData.get('BranchId'),
            BpkbDate: formData.get('TanggalBPKB'),
            FakturNo: formData.get('NoFaktur'),
            FakturDate: formData.get('TanggalFaktur'),
            LocationId: formData.get('LokasiPenyimpanan'),
            PoliceNo: formData.get('NoPolisi'),
            BpkbDateIn: formData.get('TanggalBPKBIn'),
            CreatedBy: "@Model.Username",
        };
        console.log(data);

        fetch('https://localhost:7156/api/User/insert', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data),
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('responseMessage').innerHTML = `<div class="alert">Data Saved successfully!</div>`;
                if (data.message == "Data updated successfully" || data.message == "Data inserted successfully") document.getElementById('addDataForm').reset();
            })
            .catch(error => {
                document.getElementById('responseMessage').innerHTML = `<div class="alert" style="background-color: #dc3545;">Failed to add data</div>`;
            });
    });

    function fetchLocations() {
        fetch('https://localhost:7156/api/User/getlocation', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({})
        })
            .then(response => response.json())
            .then(data => {
                const locationSelect = document.getElementById('LokasiPenyimpanan');
                locationSelect.innerHTML = '';
                data.forEach(location => {
                    const option = document.createElement('option');
                    option.value = location.locationId;
                    option.textContent = location.locationName;
                    locationSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching locations:', error);
            });
        getData();
    }

    function getData() {
        fetch('https://localhost:7156/api/User/getdata', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({})
        })
            .then(response => response.json())
            .then(data => {
                const tableBody = document.querySelector('#dataTable tbody');
                tableBody.innerHTML = '';
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                                <td>${item.agreementNumber}</td>
                                <td>${item.bpkbNo}</td>
                                <td>${item.branchId}</td>
                                <td>${item.bpkbDate ? item.bpkbDate.substring(0, 10) : ''}</td>
                                <td>${item.fakturNo}</td>
                                <td>${item.fakturDate ? item.bpkbDate.substring(0, 10) : ''}</td>
                                <td>${item.locationName}</td>
                                <td>${item.policeNo}</td>
                                <td>${item.bpkbDateIn ? item.bpkbDate.substring(0, 10) : ''}</td>
                            <td>
                                    <button class="btn btn-danger btn-sm" onclick="deleteData('${item.agreementNumber}')">Delete</button>
                            </td>
                        `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    }

    function deleteData(agreementNumber) {
        if (!confirm(`Are you sure you want to delete Agreement Number: ${agreementNumber}?`)) return;

        fetch('https://localhost:7156/api/User/deletedata', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ AgreementNumber: agreementNumber })
        })
            .then(response => response.json())
            .then(data => {
                if (data.message === "Data deleted successfully") {
                    alert('Data deleted successfully!');
                    getData();
                } else {
                    alert('Failed to delete data!');
                }
            })
            .catch(error => {
                console.error('Error deleting data:', error);
                alert('Error deleting data!');
            });
    }

    document.addEventListener('DOMContentLoaded', fetchLocations);
</script>