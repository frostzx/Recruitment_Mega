@{
}
@model User

<h2>Welcome, @Model.Username!</h2>
<p>Your user ID is @Model.UserId</p>
<p>Your account is @(Model.IsActive ? "Active" : "Inactive")</p>

<button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addDataModal">
    Add Data
</button>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Agreement Number</th>
            <th>Branch Id</th>
            <th>No. BPKB</th>
            <th>Tanggal BPKB In</th>
            <th>Tanggal BPKB</th>
            <th>No. Faktur</th>
            <th>Tanggal Faktur</th>
            <th>No. Polisi</th>
            <th>Lokasi Penyimpanan</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="data-table-body">
    </tbody>
</table>

<div class="modal fade" id="addDataModal" tabindex="-1" aria-labelledby="addDataModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addDataModalLabel">Add Data</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addDataForm">
                    <div class="mb-3">
                        <label for="AgreementNumber" class="form-label">Agreement Number</label>
                        <input type="text" class="form-control" id="AgreementNumber" required />
                    </div>
                    <div class="mb-3">
                        <label for="BranchId" class="form-label">Branch Id</label>
                        <input type="text" class="form-control" id="BranchId" required />
                    </div>
                    <div class="mb-3">
                        <label for="NoBPKB" class="form-label">No. BPKB</label>
                        <input type="text" class="form-control" id="NoBPKB" required />
                    </div>
                    <div class="mb-3">
                        <label for="TanggalBPKBIn" class="form-label">Tanggal BPKB In</label>
                        <input type="date" class="form-control" id="TanggalBPKBIn" required />
                    </div>
                    <div class="mb-3">
                        <label for="TanggalBPKB" class="form-label">Tanggal BPKB</label>
                        <input type="date" class="form-control" id="TanggalBPKB" required />
                    </div>
                    <div class="mb-3">
                        <label for="NoFaktur" class="form-label">No. Faktur</label>
                        <input type="text" class="form-control" id="NoFaktur" required />
                    </div>
                    <div class="mb-3">
                        <label for="TanggalFaktur" class="form-label">Tanggal Faktur</label>
                        <input type="date" class="form-control" id="TanggalFaktur" required />
                    </div>
                    <div class="mb-3">
                        <label for="NoPolisi" class="form-label">No. Polisi</label>
                        <input type="text" class="form-control" id="NoPolisi" required />
                    </div>
                    <div class="mb-3">
                        <label for="LokasiPenyimpanan" class="form-label">Lokasi Penyimpanan</label>
                        <select class="form-control" id="LokasiPenyimpanan" required>
                            <option value="Location1">Location 1</option>
                            <option value="Location2">Location 2</option>
                            <option value="Location3">Location 3</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editDataModal" tabindex="-1" aria-labelledby="editDataModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDataModalLabel">Edit Data</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editDataForm">
                    <input type="hidden" id="editDataId" />
                    <div class="mb-3">
                        <label for="editAgreementNumber" class="form-label">Agreement Number</label>
                        <input type="text" class="form-control" id="editAgreementNumber" required />
                    </div>
                    <div class="mb-3">
                        <label for="editBranchId" class="form-label">Branch Id</label>
                        <input type="text" class="form-control" id="editBranchId" required />
                    </div>
                    <div class="mb-3">
                        <label for="editNoBPKB" class="form-label">No. BPKB</label>
                        <input type="text" class="form-control" id="editNoBPKB" required />
                    </div>
                    <div class="mb-3">
                        <label for="editTanggalBPKBIn" class="form-label">Tanggal BPKB In</label>
                        <input type="date" class="form-control" id="editTanggalBPKBIn" required />
                    </div>
                    <div class="mb-3">
                        <label for="editTanggalBPKB" class="form-label">Tanggal BPKB</label>
                        <input type="date" class="form-control" id="editTanggalBPKB" required />
                    </div>
                    <div class="mb-3">
                        <label for="editNoFaktur" class="form-label">No. Faktur</label>
                        <input type="text" class="form-control" id="editNoFaktur" required />
                    </div>
                    <div class="mb-3">
                        <label for="editTanggalFaktur" class="form-label">Tanggal Faktur</label>
                        <input type="date" class="form-control" id="editTanggalFaktur" required />
                    </div>
                    <div class="mb-3">
                        <label for="editNoPolisi" class="form-label">No. Polisi</label>
                        <input type="text" class="form-control" id="editNoPolisi" required />
                    </div>
                    <div class="mb-3">
                        <label for="editLokasiPenyimpanan" class="form-label">Lokasi Penyimpanan</label>
                        <select class="form-control" id="editLokasiPenyimpanan" required>
                            <option value="Location1">Location 1</option>
                            <option value="Location2">Location 2</option>
                            <option value="Location3">Location 3</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    async function fetchData() {
        const response = await fetch('https://localhost:7156/api/User/getData');
        const data = await response.json();

        const tableBody = document.getElementById('data-table-body');
        tableBody.innerHTML = ''; // Clear existing data

        data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${item.AgreementNumber}</td>
                    <td>${item.BranchId}</td>
                    <td>${item.NoBPKB}</td>
                    <td>${item.TanggalBPKBIn}</td>
                    <td>${item.TanggalBPKB}</td>
                    <td>${item.NoFaktur}</td>
                    <td>${item.TanggalFaktur}</td>
                    <td>${item.NoPolisi}</td>
                    <td>${item.LokasiPenyimpanan}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editData(${item.Id})">Edit</button>
                    </td>
                `;
            tableBody.appendChild(row);
        });
    }

    // Function to handle edit button click
    function editData(id) {
        // Fetch data for the specific item and populate the edit form
        const response = await fetch(`https://localhost:7156/api/User/getDataById?id=${id}`);  // Use actual API URL
        const item = await response.json();

        document.getElementById('editDataId').value = item.Id;
        document.getElementById('editAgreementNumber').value = item.AgreementNumber;
        document.getElementById('editBranchId').value = item.BranchId;
        document.getElementById('editNoBPKB').value = item.NoBPKB;
        document.getElementById('editTanggalBPKBIn').value = item.TanggalBPKBIn;
        document.getElementById('editTanggalBPKB').value = item.TanggalBPKB;
        document.getElementById('editNoFaktur').value = item.NoFaktur;
        document.getElementById('editTanggalFaktur').value = item.TanggalFaktur;
        document.getElementById('editNoPolisi').value = item.NoPolisi;
        document.getElementById('editLokasiPenyimpanan').value = item.LokasiPenyimpanan;

        // Show the modal
        const editModal = new bootstrap.Modal(document.getElementById('editDataModal'));
        editModal.show();
    }

    // Function to handle add data form submit
    document.getElementById('addDataForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const formData = new FormData(event.target);

        // Send API request to add data
        fetch('https://localhost:7156/api/User/addData', { // Use actual API URL
            method: 'POST',
            body: formData,
        }).then(response => response.json()).then(data => {
            alert('Data added successfully!');
            fetchData(); // Refresh the data table
        }).catch(error => {
            alert('Failed to add data');
        });
    });

    // Function to handle edit data form submit
    document.getElementById('editDataForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const formData = new FormData(event.target);

        // Send API request to edit data
        fetch('https://localhost:7156/api/User/editData', { // Use actual API URL
            method: 'POST',
            body: formData,
        }).then(response => response.json()).then(data => {
            alert('Data updated successfully!');
            fetchData(); // Refresh the data table
        }).catch(error => {
            alert('Failed to update data');
        });
    });

    // Fetch data when the page loads
    document.addEventListener('DOMContentLoaded', fetchData);
</script>
